<!DOCTYPE html>
<html lang="en">
  <head>
  <!-- so meta -->
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="HandheldFriendly" content="True">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <!-- title -->
  <title>【JS设计模式】策略模式</title>
  <!-- styles -->
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 4.2.1"></head>
  <body style="background-color: #2d2d2d">
    
      <div class="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <div class="toc-wrap">
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#策略模式"><span class="toc-number">1.</span> <span class="toc-text">策略模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#举个例子-——-发奖金"><span class="toc-number">1.1.</span> <span class="toc-text">举个例子 —— 发奖金</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#策略模式的应用"><span class="toc-number">2.</span> <span class="toc-text">策略模式的应用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#缓动动画"><span class="toc-number">2.1.</span> <span class="toc-text">缓动动画</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#表单校验"><span class="toc-number">2.2.</span> <span class="toc-text">表单校验</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#总结"><span class="toc-number">3.</span> <span class="toc-text">总结</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#优缺点"><span class="toc-number">3.1.</span> <span class="toc-text">优缺点</span></a></li></ol></li></ol>
  </div>
</div>

    
    <div class="layout-content">
      <header class="layout-header">
  <nav class="header-top">
    <ul class="menu">
       
        <li class="menu-item ">
          <a href="/">Home</a>
        </li>
       
        <li class="menu-item ">
          <a href="/archives">Writing</a>
        </li>
       
        <li class="menu-item ">
          <a href="/categories">Category</a>
        </li>
       
        <li class="menu-item ">
          <a href="/about">About</a>
        </li>
      
    </ul>
  </nav>
  
  
    <div class="content">
      <div class="post-header">
        <div class="pic">
          <img src="/images/avatar.jpg" />
        </div>
        <div class="info">
          <div class="title">【JS设计模式】策略模式</div>
          <div class="post-meta">
            <div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
              <span itemprop="name">Yx1aoq1</span>
            </div>
            
  <div class="meta">
    
      <time datetime="2020-08-18T09:58:05.000Z" itemprop="datePublished">2020-08-18</time>
      
    
  </div>

            
	<div class="article-category">
		<i class="fas fa-archive"></i>
		<a class="category-link" href="/categories/JS%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">JS设计模式</a>
	</div>


            
	<div class="article-tag">
		<i class="fas fa-tag"></i>
		<a class="tag-link" href="/tags/JavaScript/" rel="tag">JavaScript</a>
	</div>


          </div>
        </div>
      </div>
    </div>
  
</header>
      <main class="layout-main">
        <article class="content">
  <h2 id="策略模式"><a href="#策略模式" class="headerlink" title="策略模式"></a>策略模式</h2><p>在程序设计中，我们常常遇到一种情况：要实现某一个功能，有多种方案可以选择。针对不同的情况，使用不同的方案。要解决这个问题，就会使用到策略模式。</p>
<p>策略模式的定义：</p>
<blockquote>
<p>定义一系列的算法，把它们一个个封装起来，并且使它们可以互相替换。</p>
</blockquote>
<h3 id="举个例子-——-发奖金"><a href="#举个例子-——-发奖金" class="headerlink" title="举个例子 —— 发奖金"></a>举个例子 —— 发奖金</h3><p>假设绩效分为A、B、C、D四个等级，绩效A的可以获得1.75倍工资，B获得1.5倍，C获得1倍，D获得0.5倍。下面实现一个计算绩效金额的函数：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">calcBonus</span> (<span class="params">level, salary</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">switch</span> (level) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'A'</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="number">2</span> * salary</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'B'</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="number">1.75</span> * salary</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'C'</span>:</span><br><span class="line">      <span class="keyword">return</span> salary</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'D'</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0.5</span> * salary</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">calcBonus(<span class="string">'A'</span>, <span class="number">5000</span>) <span class="comment">// 10000</span></span><br></pre></td></tr></table></figure>

<p>这段代码简单，但存在几个问题：</p>
<ul>
<li>代码量庞大，需要覆盖所有的绩效等级，这样就要写很多case</li>
<li>缺乏扩展性，假设增加一个绩效等级，或者调整等级系数，需要修改内部方法</li>
<li>算法复用性差，如果在程序其他地方使用，只能复制粘贴</li>
</ul>
<p><strong>▼改进-1</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">performanceA</span> (<span class="params">salary</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">2</span> * salary</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">performanceB</span> (<span class="params">salary</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1.75</span> * salary</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">performanceC</span> (<span class="params">salary</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> salary</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">performanceD</span> (<span class="params">salary</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0.5</span> * salary</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">calcBonus</span> (<span class="params">level, salary</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">switch</span> (level) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'A'</span>:</span><br><span class="line">      <span class="keyword">return</span> performanceA(salary)</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'B'</span>:</span><br><span class="line">      <span class="keyword">return</span> performanceB(salary)</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'C'</span>:</span><br><span class="line">      <span class="keyword">return</span> performanceC(salary)</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'D'</span>:</span><br><span class="line">      <span class="keyword">return</span> performanceD(salary)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">calcBonus(<span class="string">'A'</span>, <span class="number">5000</span>) <span class="comment">// 10000</span></span><br></pre></td></tr></table></figure>

<p>上面这段代码，把绩效的计算算法抽了出来，解决了复用性问题，其他地方可以直接拿去计算某个等级的绩效。但依然没有解决扩展和代码量的问题。</p>
<p><strong>▼改进-2</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> performanceA =  <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">performanceA.prototype.calculate = <span class="function">(<span class="params">salary</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">2</span> * salary</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> Bonus = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">this</span>.salary = <span class="literal">null</span></span><br><span class="line">  <span class="keyword">this</span>.strategy = <span class="literal">null</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Bonus.prototype.setSalary = <span class="function">(<span class="params">salary</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">this</span>.salary = salary</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Bonus.prototype.setStrategy = <span class="function">(<span class="params">strategy</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">this</span>.strategy = strategy</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Bonus.prototype.getBonus = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 把计算奖金的操作委托给对应的策略对象</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.strategy.calculate(<span class="keyword">this</span>.salary)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 计算</span></span><br><span class="line"><span class="keyword">let</span> bonus = <span class="keyword">new</span> Bonus() </span><br><span class="line">bonus.setSalary(<span class="number">5000</span>)</span><br><span class="line">bonus.setStrategy(<span class="keyword">new</span> performanceA())</span><br><span class="line"><span class="comment">// bonus本身没有能力计算，而是把请求委托给了之前设置的的策略对象</span></span><br><span class="line">bonus.getBonus()</span><br></pre></td></tr></table></figure>

<p>策略模式的目的就是<strong>将算法的使用与算法的实现分离开来</strong>。一个基于策略模式的程序至少由两部分组成，一部分是一组策略类，策略类封装了具体的算法，并负责具体的计算过程。第二个部分是环境类Context，Context接受客户的请求，随后把请求委托给某一个策略类。</p>
<p>当然我们可以对上面的代码进行简化：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> strategies = &#123;</span><br><span class="line">  <span class="string">'A'</span>: <span class="function">(<span class="params">salary</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">2</span> * salary</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> calcBonus = <span class="function">(<span class="params">level, salary</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> strategies[level](salary)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="策略模式的应用"><a href="#策略模式的应用" class="headerlink" title="策略模式的应用"></a>策略模式的应用</h2><h3 id="缓动动画"><a href="#缓动动画" class="headerlink" title="缓动动画"></a>缓动动画</h3><p><strong>▼动画原理</strong></p>
<p>把一些差距不大的原画以较块的帧数播放，来达到视觉上的动画效果。</p>
<p><strong>▼JavaScript如何实现帧数播放</strong></p>
<p>在 JavaScript中，可以通过连续改变元素的某个CSS属性，比如 left 、 top 、 background-position 来实现动画效果。</p>
<p><strong>▼实现代码</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 策略类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;number&#125;</span> </span>t 动画已消耗的时间</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;number&#125;</span> </span>b 小球的原始位置</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;number&#125;</span> </span>c 小球的目标位置</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;number&#125;</span> </span>d 动画持续的总时间</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">let</span> tween = &#123;</span><br><span class="line">  linear: <span class="function">(<span class="params">t, b, c, d</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> c * t / d + b</span><br><span class="line">  &#125;,</span><br><span class="line">  easeIn: <span class="function">(<span class="params">t, b, c, d</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> c * ( t /= d ) * t + b</span><br><span class="line">  &#125;,</span><br><span class="line">  strongEaseIn: <span class="function">(<span class="params">t, b, c, d</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> c * ( t /= d ) * t * t * t * t + b</span><br><span class="line">  &#125;,</span><br><span class="line">  strongEaseOut: <span class="function">(<span class="params">t, b, c, d</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> c * ( ( t = t / d - <span class="number">1</span>) * t * t * t * t + <span class="number">1</span> ) + b</span><br><span class="line">  &#125;,</span><br><span class="line">  sineaseIn: <span class="function">(<span class="params">t, b, c, d</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> c * ( t /= d) * t * t + b</span><br><span class="line">  &#125;,</span><br><span class="line">  sineaseOut: <span class="function">(<span class="params">t, b, c, d</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> c * ( ( t = t / d - <span class="number">1</span>) * t * t + <span class="number">1</span> ) + b</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义Animate类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animate</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span> (dom) &#123;</span><br><span class="line">    <span class="keyword">this</span>.dom = dom <span class="comment">// 进行运动的dom节点</span></span><br><span class="line">    <span class="keyword">this</span>.startTime = <span class="number">0</span> <span class="comment">// 动画开始时间</span></span><br><span class="line">    <span class="keyword">this</span>.startPos = <span class="number">0</span> <span class="comment">// 动画开始时，dom节点的初始位置</span></span><br><span class="line">    <span class="keyword">this</span>.endPos = <span class="number">0</span> <span class="comment">// 动画结束后，dom节点的目标位置</span></span><br><span class="line">    <span class="keyword">this</span>.propertyName = <span class="literal">null</span> <span class="comment">// dom节点需要倍改变的css属性名</span></span><br><span class="line">    <span class="keyword">this</span>.easing = <span class="literal">null</span> <span class="comment">// 缓动算法</span></span><br><span class="line">    <span class="keyword">this</span>.duration = <span class="literal">null</span> <span class="comment">// 动画持续时间</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  start (propertyName, endPos, duration, easing) &#123;</span><br><span class="line">    <span class="keyword">this</span>.startTime = +<span class="keyword">new</span> <span class="built_in">Date</span>()</span><br><span class="line">    <span class="keyword">this</span>.startPos = <span class="keyword">this</span>.dom.getBoundingClientRect()[ propertyName ]</span><br><span class="line">    <span class="keyword">this</span>.propertyName = propertyName</span><br><span class="line">    <span class="keyword">this</span>.endPos = endPos</span><br><span class="line">    <span class="keyword">this</span>.duration = duration</span><br><span class="line">    <span class="keyword">this</span>.easing = tween[ easing ]</span><br><span class="line">    <span class="keyword">const</span> timer = setInterval(<span class="function"><span class="params">()</span> =&gt;</span> &#123; <span class="comment">// 启动定时器，开始执行动画</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.step() === <span class="literal">false</span>) &#123; <span class="comment">// 如果动画已结束，则清除定时器</span></span><br><span class="line">        clearInterval(timer)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;, <span class="number">19</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  step () &#123;</span><br><span class="line">    <span class="keyword">const</span> t = +<span class="keyword">new</span> <span class="built_in">Date</span>()</span><br><span class="line">    <span class="keyword">if</span> (t &gt;= <span class="keyword">this</span>.startTime + <span class="keyword">this</span>.duration) &#123;</span><br><span class="line">      <span class="keyword">this</span>.update(<span class="keyword">this</span>.endPos)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> pos = <span class="keyword">this</span>.easing(t - <span class="keyword">this</span>.startTime, <span class="keyword">this</span>.startPos, <span class="keyword">this</span>.endPos - <span class="keyword">this</span>.startPos, <span class="keyword">this</span>.duration)</span><br><span class="line">    <span class="keyword">this</span>.update(pos)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  update (pos) &#123;</span><br><span class="line">    <span class="keyword">this</span>.dom.style[<span class="keyword">this</span>.propertyName] = pos + <span class="string">'px'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 动画演示</span></span><br><span class="line"><span class="keyword">const</span> div = <span class="built_in">document</span>.getElementById(<span class="string">'div'</span>)</span><br><span class="line"><span class="keyword">const</span> animate = <span class="keyword">new</span> Animate(div)</span><br><span class="line">animate.start(<span class="string">'left'</span>, <span class="number">500</span>, <span class="number">1000</span>, <span class="string">'strongEaseOut'</span>)</span><br></pre></td></tr></table></figure>

<h3 id="表单校验"><a href="#表单校验" class="headerlink" title="表单校验"></a>表单校验</h3><p>假设有一个注册页面，点击注册按钮，需要校验如下几条逻辑：</p>
<ul>
<li>用户名不能为空</li>
<li>密码长度不能少于6位</li>
<li>手机号码必须符合格式</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"http://xxx.com/register"</span> <span class="attr">id</span>=<span class="string">"registerForm"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">      请输入用户名：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"userName"</span> /&gt;</span></span><br><span class="line">      请输入密码：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"password"</span> /&gt;</span></span><br><span class="line">      请输入手机号码：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"phoneNumber"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span>&gt;</span>提交<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    	<span class="keyword">var</span> registerForm = <span class="built_in">document</span>.getElementById(<span class="string">'registerForm'</span>)</span></span><br><span class="line"><span class="actionscript">      registerForm.onsubmit = <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">if</span> (registerForm.userName.value === <span class="string">''</span>) &#123;</span></span><br><span class="line"><span class="actionscript">          alert(<span class="string">'用户名不能为空'</span>)</span></span><br><span class="line"><span class="actionscript">          <span class="keyword">return</span> <span class="literal">false</span></span></span><br><span class="line">        &#125;</span><br><span class="line">        if (registerForm.password.value.length &lt; 6) &#123;</span><br><span class="line"><span class="actionscript">          alert(<span class="string">'密码长度不能少于 6 位'</span>)</span></span><br><span class="line"><span class="actionscript">          <span class="keyword">return</span> <span class="literal">false</span></span></span><br><span class="line">        &#125;</span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> (!<span class="regexp">/(^1[3|5|8][0-9]&#123;9&#125;$)/</span>.test( registerForm.phoneNumber.value )) &#123;</span></span><br><span class="line"><span class="actionscript">          alert (<span class="string">'手机号码格式不正确'</span>)</span></span><br><span class="line"><span class="actionscript">          <span class="keyword">return</span> <span class="literal">false</span></span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这是实现需求的最简单的方式，但是它存在一些问题：</p>
<ul>
<li><code>registerForm.onsubmit</code>函数比较庞大，包好了许多<code>if-else</code>语句，这些语句需要覆盖所有的校验规则</li>
<li><code>registerForm.onsubmit</code>函数缺乏弹性，如果增加了一种新的校验规则，或者想把密码的长度校验从6改成8，都必须改动到内部代码，违反了开放-封闭原则</li>
<li>算法复用性差，如果在其他地方有相同的校验，则只能将这段代码复制过去</li>
</ul>
<p><strong>▼使用策略模式优化</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 校验规则抽成策略类</span></span><br><span class="line"><span class="keyword">var</span> strategies = &#123;</span><br><span class="line">  isNonEmpty: <span class="function"><span class="keyword">function</span> (<span class="params">value, errorMsg</span>) </span>&#123; <span class="comment">// 不为空</span></span><br><span class="line">    <span class="keyword">if</span> (value === <span class="string">''</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> errorMsg</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  minLength: <span class="function"><span class="keyword">function</span> (<span class="params">value, length, errorMsg</span>) </span>&#123; <span class="comment">// 限制最小长度</span></span><br><span class="line">    <span class="keyword">if</span> (value.length &lt; length) &#123;</span><br><span class="line">      <span class="keyword">return</span> errorMsg</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  isMobile: <span class="function"><span class="keyword">function</span> (<span class="params">value, errorMsg</span>) </span>&#123; <span class="comment">// 手机号码格式</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="regexp">/(^1[3|5|8][0-9]&#123;9&#125;$)/</span>.test(value)) &#123;</span><br><span class="line">      <span class="keyword">return</span> errorMsg</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Validator类</span></span><br><span class="line"><span class="keyword">var</span> Validator = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.cache = []</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Validator.prototype.add = <span class="function"><span class="keyword">function</span> (<span class="params">dom, rule, errorMsg</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// rule 为 策略名称:策略参数 的格式</span></span><br><span class="line">  <span class="keyword">var</span> ary = rule.split(<span class="string">':'</span>)</span><br><span class="line">  <span class="keyword">this</span>.cache.push(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> strategy = ary.shift()</span><br><span class="line">    ary.unshift(dom.value)</span><br><span class="line">    ary.push(errorMsg)</span><br><span class="line">    <span class="comment">// ary = [dom.value, strategyParams, errorMsg]</span></span><br><span class="line">    <span class="keyword">return</span> strategies[strategy].apply(dom, ary)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Validator.prototype.start = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, validatorFunc; validatorFunc = <span class="keyword">this</span>.cache[ i++ ];) &#123;</span><br><span class="line">    <span class="keyword">var</span> msg = validatorFunc()</span><br><span class="line">    <span class="keyword">if</span> (msg) &#123;</span><br><span class="line">      <span class="keyword">return</span> msg</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 使用环境</span></span><br><span class="line"><span class="keyword">var</span> validateFunc = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> validator = <span class="keyword">new</span> Validator()</span><br><span class="line">  </span><br><span class="line">  validator.add(registerForm.userName, <span class="string">'isNonEmpty'</span>, <span class="string">'用户名不能为空'</span>)</span><br><span class="line">  validator.add(registerForm.password, <span class="string">'minLength:6'</span>, <span class="string">'密码长度不能少于6'</span>)</span><br><span class="line">  validator.add(registerForm.phoneNumber, <span class="string">'isMobile'</span>, <span class="string">'手机号码格式不正确'</span>)</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">var</span> errorMsg = validator.start()</span><br><span class="line">  <span class="keyword">return</span> errorMsg</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> registerForm = <span class="built_in">document</span>.getElementById(<span class="string">'registerForm'</span>)</span><br><span class="line">registerForm.onsubmit = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> errorMsg = validateFunc()</span><br><span class="line">  <span class="keyword">if</span> (errorMsg) &#123;</span><br><span class="line">    alert(errorMsg)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用策略模式重构代码之后，我们仅仅通过“配置”的方式就可以完成一个表单的校验，这些校验规则可以复用在程序的任何地方，还能作为插件的形式，方便地移植到其他项目中。</p>
<p><strong>▼进阶——同时校验多个规则</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 修改Validator类</span></span><br><span class="line"><span class="keyword">var</span> Validator = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.cache = []</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Validator.prototype.add = <span class="function"><span class="keyword">function</span> (<span class="params">dom, rules</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> self = <span class="keyword">this</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, rule; rule = rules[ i++ ];) &#123;</span><br><span class="line">    (<span class="function"><span class="keyword">function</span> (<span class="params">rule</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// rule 为 策略名称:策略参数 的格式</span></span><br><span class="line">      <span class="keyword">var</span> strategyAry = rule.strategy.split(<span class="string">':'</span>)</span><br><span class="line">      <span class="keyword">var</span> errorMsg = rule.errorMsg</span><br><span class="line">      self.cache.push(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> strategy = strategyAry.shift()</span><br><span class="line">        strategyAry.unshift(dom.value)</span><br><span class="line">        strategyAry.push(errorMsg)</span><br><span class="line">        <span class="comment">// strategyAry = [dom.value, strategyParams, errorMsg]</span></span><br><span class="line">        <span class="keyword">return</span> strategies[strategy].apply(dom, strategyAry)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)(rule)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Validator.prototype.start = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, validatorFunc; validatorFunc = <span class="keyword">this</span>.cache[ i++ ];) &#123;</span><br><span class="line">    <span class="keyword">var</span> msg = validatorFunc()</span><br><span class="line">    <span class="keyword">if</span> (msg) &#123;</span><br><span class="line">      <span class="keyword">return</span> msg</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 使用环境</span></span><br><span class="line"><span class="keyword">var</span> validateFunc = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> validator = <span class="keyword">new</span> Validator()</span><br><span class="line">  </span><br><span class="line">  validator.add(registerForm.userName, [&#123;</span><br><span class="line">    strategy: <span class="string">'isNonEmpty'</span>,</span><br><span class="line">    errorMsg: <span class="string">'用户名不能为空'</span></span><br><span class="line">  &#125;, &#123;</span><br><span class="line">    strategy: <span class="string">'minLength:10'</span>,</span><br><span class="line">    errorMsg: <span class="string">'用户名长度不能小于10位'</span></span><br><span class="line">  &#125;])</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">var</span> errorMsg = validator.start()</span><br><span class="line">  <span class="keyword">return</span> errorMsg</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> registerForm = <span class="built_in">document</span>.getElementById(<span class="string">'registerForm'</span>)</span><br><span class="line">registerForm.onsubmit = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> errorMsg = validateFunc()</span><br><span class="line">  <span class="keyword">if</span> (errorMsg) &#123;</span><br><span class="line">    alert(errorMsg)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><h3 id="优缺点"><a href="#优缺点" class="headerlink" title="优缺点"></a>优缺点</h3><ul>
<li>优点：<ul>
<li>利用组合、委托和多态等技术和思想，可以有效避免多重条件的选择语句</li>
<li>提供了开放-封闭原则的完美支持，将算法封装在独立的strategy中，使得它们易于切换、理解与扩展</li>
<li>利用组合和委托来让Context拥有执行算法的能力，这也是继承的一种更轻便的代替方案</li>
</ul>
</li>
<li>缺点：<ul>
<li>使用策略模式会在程序中增加许多策略类或策略对象</li>
<li>必须了解所有的strategy，才能正确的选择一个合适的strategy。而向客户暴露strategy的实现方式是违反最少知识原则的</li>
</ul>
</li>
</ul>
<p>文章参考：<br>《JavaScript设计模式与开发实践》</p>

</article>
<div class="prev-or-next">
  <div class="post-foot-next">
    
      <a href="/2020/08/17/JS%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E3%80%90JS%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E3%80%91%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/" target="_self">
        <i class="fas fa-angle-left"></i>
        <span>Previous post</span>
      </a>
    
  </div>
  <div class="post-foot-prev">
    
      <a href="/2020/08/19/JS%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E3%80%90JS%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E3%80%91%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F/" target="_self">
        <span>Next post</span>
        <i class="fas fa-angle-right"></i>
      </a>
    
  </div>
</div>
      </main>
      <footer class="layout-footer">
  <div>
    Copyright &copy;
    
    
    2025
    Yx1aoq1
  </div>
</footer>
    </div>
    <!-- styles -->
<link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Roboto+Mono&display=swap" rel="stylesheet">

<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

    <!-- jquery -->

<script src="/lib/jquery/jquery.min.js"></script>


<script src="/js/accordion-menu.js"></script>

  </body>
</html>
