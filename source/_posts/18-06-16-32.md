---
title: JS位操作符
date: 2018-06-16 10:01:13
tags: [JavaScript]
---
ECMAScript中的所有数值都以IEEE-754 64位格式存储，但位操作符并不直接操作64位的值，而是先将64位的值转换成32位的整数，然后执行操作，最后再将结果转换回64位。

对于有符号的整数，32位中的前31位用于表示整数的值，第32位用于表示数值的符号：0表示正数，1表示负数。正数以纯二进制格式存储，负数以二进制补码格式存储。

▼ **位运算的优点**
由于位运算是在最底层执行的，速度相比加减乘除要更快，在特定的情况下可以替代普通的加减乘除。

▼ **补码计算**

* 求这个数值绝对值的二进制码
* 求二进制反码，即将0替换为1，将1替换为0
* 得到的二进制反码加1

```
// 求-18的补码
18的二进制表示： 10010
将其补足到32位： 0000 0000 0000 0000 0000 0000 0001 0010
求其二进制反码： 1111 1111 1111 1111 1111 1111 1110 1101
二进制反码加一： 1111 1111 1111 1111 1111 1111 1110 1110
```
**注意：**在处理有符号整数时，是不能访问位31的

## 基本运算
### 按位非
```js
var num1 = 25;    // 0000 0000 0000 0000 0000 0000 0001 1001
var num2 = ~num1; // 1111 1111 1111 1111 1111 1111 1110 0110 = -26
```
**按位非操作的本质，是操作数的负值减1**
### 按位与
```js
var result = 25 & 3; // 1
// 25 = 0000 0000 0000 0000 0000 0000 0001 1001
//  3 = 0000 0000 0000 0000 0000 0000 0000 0011
//-----------------------------------------------
//and = 0000 0000 0000 0000 0000 0000 0000 0001
```
**25和3的二进制码对应位上只有一位同时是1，而其他位的结果都是0，所有最后结果为1**
### 按位或
```js
var result = 25 | 3; // 27
// 25 = 0000 0000 0000 0000 0000 0000 0001 1001
//  3 = 0000 0000 0000 0000 0000 0000 0000 0011
//-----------------------------------------------
// or = 0000 0000 0000 0000 0000 0000 0001 1011
```
### 按位异或
```js
var result = 25 ^ 3; // 26
// 25 = 0000 0000 0000 0000 0000 0000 0001 1001
//  3 = 0000 0000 0000 0000 0000 0000 0000 0011
//-----------------------------------------------
//xor = 0000 0000 0000 0000 0000 0000 0001 1010
```
**异或的计算是当对应位上只有一个1时返回1，都是0或都是1时返回0**
### 左移
```js
var oldValue = 2;
var newValue = oldValue << 5;
// 0000 0000 0000 0000 0000 0000 0000 0010
// 0000 0000 0000 0000 0000 0000 0100 0000
```
**将10向左移动五位，往末尾开始补5个0**
### 有符号的右移
```js
var oldValue = 64;
var newValue = oldValue >> 5;
// 0000 0000 0000 0000 0000 0000 0100 0000
// 0000 0000 0000 0000 0000 0000 0000 0010
```
**有符号的右移，是在第31个位置开始补0，同理可得无符号的右移，是从第32个位置开始补0**

## 应用技巧
### 异或的应用
▼ **不用中间变量交换两个数**
```js
a = a ^ b;
b = b ^ a;
a = a ^ b;
```
▼ **寻找只出现1次的一个数，其他数出现偶数次（或寻找唯一一个出现奇数次的数，其他数出现偶数次）**
将所有的数进行异或运算，最后的结果就是要找的那个数

### 不用 +-*/ 做加法