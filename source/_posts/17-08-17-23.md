---
title: 网络知识补充——浏览器请求过程
date: 2017-08-17 20:49:56
tags:
---
当我们在浏览器中输入一个url，页面是如何呈现出来的呢？
<!--more-->

![](https://github.com/Yx1aoq1/Yx1aoq1.github.io/raw/master/images/http.png)

首先，我们在浏览器中输入一个url，浏览器的核心代码会将这个url进行拆分解析。
以Chrome浏览器为例，其解析过程：
* 搜索浏览器自身的DNS缓存，看这个域名的IP地址是否已经缓存
* 搜索操作系统自身的DNS缓存（浏览器没有找到缓存或缓存已经失效）
* 读取本地的HOST文件（操作系统的DNS缓存也没有找到）
* 浏览器发起一个DNS的一个系统调用，向宽带运营商的DNS服务器发送一个域名请求

紧接着我们就来到了DNS服务器，DNS服务器接受到请求后，开始如下操作：
* 查找本地缓存
* 如果未找到对应条目，则服务器将发起一个迭代DNS解析的请求
* 将迭代查询后的结果返回给操作系统内核同时进行缓存

之后操作系统内核把结果返回给浏览器，浏览器拿到了域名对应的IP地址。这时，浏览器就可以向这个IP地址发送请求，请求通过我们的协议，经过了层层的网络，到达服务端。服务端有一个MVC架构，请求首先会进入`Controller`层，进行相关的逻辑处理，以及请求的分发，然后来调用`Model`层，`Model`层主要负责与数据的交互，在交互过程中会它会读取`redis`和数据库中存储的数据，最终将渲染好的页面通过`View`层返回给网络。这时，`httpResponse`就通过层层网络回到浏览器，浏览器根据请求回来的`html`、`css`、`js`进行渲染，最终将页面展现在我们面前。

## DNS

DNS全名Domain Name System，我们在互联网中，我们通过IP地址来进行通信，由于IP地址是用数字表示的，看着很不直观难以记忆，所以使用域名来帮助记忆，如：`http://www.baidu.com/`，而DNS的作用就是将域名转换成IP，或将IP转换成域名，这个过程也叫做解析。
**Tip：**电脑中的HOST文件是通过静态匹配IP和域名

#### 域名空间结构

* 根域：`.`，根域名的服务器只有13台
* 顶级域（一级域）：`edu`、`gov`、`com`、`org`、`mil`、`cn`等，由域名分配组织ISO决定
  * 组织域
  ```
  gov         政府部门
  com         商业部门
  edu         教育部门
  org         民间团体组织
  net         网络服务机构
  mil         军事部门
  ```
  * 国家或地区域
  ```
  cn          中国
  jp          日本
  uk          英国
  au          澳大利亚
  hk          中国香港
  ```
* 二级域：个人和企业向域名分配组织申请的，需要购买，如`baidu`、`sina`等
* 主机名（三级域）：申请完二级域名后自己规定的，如`www`（代表网页服务）、`NEWS`

一个完整的域名是由三级域 + 二级域 + 一级域组成的，并且是全球唯一的。
在互联网中，域名是由结构有规划的。因为域名进行了分级，在进行域名和IP地址解析时才能更容易的找到，即根域名只负责管理一级域名，而一级域名负责管理自己以下的二级域名，以此类推。

#### DNS查询过程

![](https://github.com/Yx1aoq1/Yx1aoq1.github.io/raw/master/images/http-2.png)

客户机向指定的域名服务器发送请求，说我想要访问`www.baidu.com.cn`这个网站，如果这台域名服务器并没有缓存这个域名的IP地址，那么它就会向根DNS服务器询问（每个本地域名服务器都会保存全球13台根服务器的IP地址），根DNS服务器将会返回它管理下的一级域名（`cn`）的IP地址，紧接着本地域名服务器就向`cn`服务器发送询问，`cn`服务器返回`com.cn`服务器的IP，然后本地服务器接着询问，直到找到`www.baidu.com.cn`的IP地址，再返回给客户机。这个过程就是**DNS迭代查询**。

## TCP/IP



