{"compress":true,"commitItems":[["d8a9db37-7fdd-4feb-801f-60ef3276268a",1560434604869,"---\ntitle: 如何开发命令行工具\ndate: 2019-06-04 22:46:46\ncategories: node相关\ntags:\n  - node\n  - fet源码\n  - cli工具\n---\n\n这是基于新哥的脚手架工具fet源码阅读的学习笔记第一篇，主要内容是如何基于`node`和其他的一些工具包来完成一些简单的命令行小工具。主要实践为一个批量重命名的命令行工具（巨简单的那种），大概梳理流程和思路。\n\n## 原理\n\n在`node`中，有一个变量叫做`process`的全局变量，当启动一个 Node.js 进程时，我们可以通过`process.argv`获得传入的命令行参数。\n![](https://github.com/Yx1aoq1/Yx1aoq1.github.io/raw/master/images/ys-1.png)\n其中：\n* `argv[0]`为[`process.execPath`](http://nodejs.cn/s/MCrAya)\n* `argv[1]`为正在执行 JavaScript 文件的路径\n* 其余元素是任何其他命令行参数\n\n通过解析`process.argv`，我们就可以执行不同的操作。\n\n##  commander.js\n\n我们可以引用`commander.js`，让命令行变得更加简单。\n下面简单示例一个图片重命名的node实现。\n```js\nvar program = require('commander')\nvar fs = require('fs')\nvar path = './'\n\nprogram\n  .version('0.0.1')\n  .description('a test cli program')\n\nprogram\n  .command('rename <format>') // 设置指令\n  .option('-n, --number <number>', '设置rename数字，默认从1开始', 1) // 设置参数\n  .option('-a, --after', '将fomat字符固定在数字后，默认在前')\n  .action(function (format, opts) { // 执行操作\n    fs.readdir(path, function(err, files) {\n      files.map(function(filename) {\n        var extname = getExtname(filename)\n        if (isImage(extname)) {\n          var newname = getNewName(format, opts, extname)\n          fs.rename(filename, newname, function(err) {\n            console.log(filename + ' --> ' + newname)\n          })\n        }\n      })\n    })\n  })\n\nprogram.parse(process.argv)\n\nfunction isImage (extname) {\n  var imageTypes = ['webp', 'png', 'svg', 'gif', 'jpg', 'jpeg', 'bmp']\n  return imageTypes.includes(extname)\n}\n\nfunction getExtname (filename) {\n  var filenameWithoutSuffix = filename.split(/#|\\?/)[0]\n  return (/[^./\\\\]*$/.exec(filenameWithoutSuffix) || [''])[0]\n}\n\nfunction getNewName (format, opts, extname) {\n  return opts.after\n         ? (opts.number ++) + format + '.' + extname\n         : format + (opts.number ++) + '.' + extname\n}\n```\n\n运行结果如图所示：\n![](https://github.com/Yx1aoq1/Yx1aoq1.github.io/raw/master/images/ys-2.png)\n",[[1560434590317,["70431@DESKTOP-QB0HG1K",[[1,1822,"yu"]],[1822,1822],[1821,1824]]],[1560434591321,["70431@DESKTOP-QB0HG1K",[[-1,1821,"\nyu\n"],[1,1825,"运行"]],[1821,1821],[1823,1823]]],[1560434592137,["70431@DESKTOP-QB0HG1K",[[-1,1821,"运行"]],[1823,1823],[1821,1821]]],[1560434592588,["70431@DESKTOP-QB0HG1K",[[1,1822,"\n"]],[1821,1821],[1822,1822]]],[1560434593133,["70431@DESKTOP-QB0HG1K",[[1,1823,"\n"]],[1822,1822],[1823,1823]]],[1560434594587,["70431@DESKTOP-QB0HG1K",[[-1,1823,"\n"],[1,1824,"运行"]],[1823,1823],[1825,1825]]],[1560434598203,["70431@DESKTOP-QB0HG1K",[[1,1825,"结果如图所示："]],[1825,1825],[1832,1832]]],[1560434598550,["70431@DESKTOP-QB0HG1K",[[1,1832,"\n\n"]],[1832,1832],[1833,1833]]],[1560434599119,["70431@DESKTOP-QB0HG1K",[[1,1833,"![](https://github.com/Yx1aoq1/Yx1aoq1.github.io/raw/master/images/ys-1.png)"]],[1833,1833],[1909,1909]]],[1560434601786,["70431@DESKTOP-QB0HG1K",[[-1,1903,"1"]],[1904,1904],[1903,1903]]],[1560434601950,["70431@DESKTOP-QB0HG1K",[[1,1903,"2"]],[1903,1903],[1904,1904]]],[1560434627519,[null,[[-1,1821,"运\n运行结果如图所示：\n![](https://github.com/Yx1aoq1/Yx1aoq1.github.io/raw/master/images/ys-2.png)\n"],[1,1910,"\n\n运"]],[1821,1821],[1913,1913]]],[1560434627520,[null,[[1,1821,"运\n运行结果如图所示：\n![](https://github.com/Yx1aoq1/Yx1aoq1.github.io/raw/master/images/ys-2.png)\n"],[-1,1821,"\n\n运"]],[1913,1913],[1821,1821]]],[1560434614887,["70431@DESKTOP-QB0HG1K",[[1,1910,"\n"]],[1909,1909],[1910,1910]]],[1560434615653,["70431@DESKTOP-QB0HG1K",[[1,1911,"\n"]],[1910,1910],[1911,1911]]],[1560434622410,["70431@DESKTOP-QB0HG1K",[[-1,1911,"\n"],[1,1912,"#"]],[1911,1911],[1912,1912]]],[1560434623150,["70431@DESKTOP-QB0HG1K",[[1,1912,"# "]],[1912,1912],[1914,1914]]],[1560434625619,["70431@DESKTOP-QB0HG1K",[[-1,1912,"# "]],[1914,1914],[1912,1912]]],[1560434625981,["70431@DESKTOP-QB0HG1K",[[-1,1911,"#"],[1,1912,"\n"]],[1912,1912],[1911,1911]]],[1560434626767,["70431@DESKTOP-QB0HG1K",[[-1,1911,"\n"]],[1911,1911],[1910,1910]]],[1560434846620,[null,[[-1,1821,"运"],[1,1822,"\n"],[-1,1911,"行结果如图所示：\n![](https://github.com/Yx1aoq1/Yx1aoq1.github.io/raw/master/images/ys-2.png)\n"]],[1821,1821],[1911,1911]]],[1560434846620,[null,[[1,1821,"运"],[-1,1821,"\n"],[1,1911,"行结果如图所示：\n![](https://github.com/Yx1aoq1/Yx1aoq1.github.io/raw/master/images/ys-2.png)\n"]],[1911,1911],[1821,1821]]],[1560434834305,["70431@DESKTOP-QB0HG1K",[[1,106,"\n"]],[105,105],[106,106]]],[1560434834553,["70431@DESKTOP-QB0HG1K",[[1,107,"\n"]],[106,106],[107,107]]],[1560434835637,["70431@DESKTOP-QB0HG1K",[[1,106,"这是基于新哥的脚手架工具fet源码阅读的学习笔记第一篇，主要内容是如何基于`node`和其他的一些工具包来完成一些简单的命令行小工具。主要实践为一个批量重命名的命令行工具（巨简单的那种），大概梳理流程和思路。"]],[106,106],[210,210]]],[1560434836489,["70431@DESKTOP-QB0HG1K",[[1,212,"\n"]],[210,210],[211,211]]],[1560434837187,["70431@DESKTOP-QB0HG1K",[[1,213,"\n"]],[211,211],[212,212]]],[1560434837752,["70431@DESKTOP-QB0HG1K",[[1,212,"《"]],[212,212],[213,213]]],[1560434838448,["70431@DESKTOP-QB0HG1K",[[-1,212,"《"]],[213,213],[212,212]]],[1560434839420,["70431@DESKTOP-QB0HG1K",[[1,212,"<!"]],[212,212],[214,214]]],[1560434840000,["70431@DESKTOP-QB0HG1K",[[-1,213,"!"]],[214,214],[213,213]]],[1560434844569,["70431@DESKTOP-QB0HG1K",[[1,213,"!--more-->"]],[213,213],[223,223]]],[1560434895193,[null,[[-1,1940,"运"],[1,1941,"\n"],[-1,2030,"行结果如图所示：\n![](https://github.com/Yx1aoq1/Yx1aoq1.github.io/raw/master/images/ys-2.png)\n"]],[1940,1940],[2030,2030]]],[1560434895193,[null,[[1,1940,"运"],[-1,1940,"\n"],[1,2030,"行结果如图所示：\n![](https://github.com/Yx1aoq1/Yx1aoq1.github.io/raw/master/images/ys-2.png)\n"]],[2030,2030],[1940,1940]]],[1560434858987,["70431@DESKTOP-QB0HG1K",[[1,2030,"\n"]],[2028,2028],[2029,2029]]],[1560434859485,["70431@DESKTOP-QB0HG1K",[[1,2031,"\n"]],[2029,2029],[2030,2030]]],[1560434872421,["70431@DESKTOP-QB0HG1K",[[1,2030,"## shi"]],[2030,2030],[2036,2036]]],[1560434873319,["70431@DESKTOP-QB0HG1K",[[-1,2033,"shi"]],[2036,2036],[2033,2033]]],[1560434877556,["70431@DESKTOP-QB0HG1K",[[1,2033,"是"]],[2033,2033],[2034,2034]]],[1560434877888,["70431@DESKTOP-QB0HG1K",[[-1,2033,"是"]],[2034,2034],[2033,2033]]],[1560434882999,["70431@DESKTOP-QB0HG1K",[[1,2033,"挂载到 n"]],[2033,2033],[2038,2038]]],[1560434883918,["70431@DESKTOP-QB0HG1K",[[-1,2036," n"]],[2038,2038],[2036,2036]]],[1560434885926,["70431@DESKTOP-QB0HG1K",[[1,2036,"`np,"]],[2036,2036],[2040,2040]]],[1560434886667,["70431@DESKTOP-QB0HG1K",[[-1,2039,","]],[2040,2040],[2039,2039]]],[1560434887869,["70431@DESKTOP-QB0HG1K",[[1,2039,"m·"]],[2039,2039],[2041,2041]]],[1560434888440,["70431@DESKTOP-QB0HG1K",[[-1,2040,"·"]],[2041,2041],[2040,2040]]],[1560434891572,["70431@DESKTOP-QB0HG1K",[[1,2040,"`上"]],[2040,2040],[2042,2042]]],[1560434894569,["70431@DESKTOP-QB0HG1K",[[1,2033,"如何"]],[2033,2033],[2035,2035]]],[1560434904075,[null,[[-1,1940,"运"],[1,1941,"\n"],[-1,2046,"行结果如图所示：\n![](https://github.com/Yx1aoq1/Yx1aoq1.github.io/raw/master/images/ys-2.png)\n"]],[1940,1940],[2046,2046]]],[1560434904075,[null,[[1,1940,"运"],[-1,1940,"\n"],[1,2046,"行结果如图所示：\n![](https://github.com/Yx1aoq1/Yx1aoq1.github.io/raw/master/images/ys-2.png)\n"]],[2046,2046],[1940,1940]]],[1560434898536,["70431@DESKTOP-QB0HG1K",[[1,2046,"\n"]],[2044,2044],[2045,2045]]],[1560434901710,["70431@DESKTOP-QB0HG1K",[[1,2047,"\n"]],[2045,2045],[2046,2046]]],[1560434902569,["70431@DESKTOP-QB0HG1K",[[-1,2047,"\n"]],[2046,2046],[2045,2045]]],[1560434910955,[null,[[-1,1940,"运"],[1,1941,"\n"],[-1,2047,"行结果如图所示：\n![](https://github.com/Yx1aoq1/Yx1aoq1.github.io/raw/master/images/ys-2.png)\n"]],[1940,1940],[2047,2047]]],[1560434910955,[null,[[1,1940,"运"],[-1,1940,"\n"],[1,2047,"行结果如图所示：\n![](https://github.com/Yx1aoq1/Yx1aoq1.github.io/raw/master/images/ys-2.png)\n"]],[2047,2047],[1940,1940]]],[1560434909451,["70431@DESKTOP-QB0HG1K",[[1,2047,"\n"]],[2045,2045],[2046,2046]]],[1560435090969,[null,[[-1,1940,"运"],[1,1941,"\n"],[-1,2048,"行结果如图所示：\n![](https://github.com/Yx1aoq1/Yx1aoq1.github.io/raw/master/images/ys-2.png)\n"]],[1940,1940],[2048,2048]]],[1560435090969,[null,[[1,1940,"运"],[-1,1940,"\n"],[1,2048,"行结果如图所示：\n![](https://github.com/Yx1aoq1/Yx1aoq1.github.io/raw/master/images/ys-2.png)\n"]],[2048,2048],[1940,1940]]],[1560435081450,["70431@DESKTOP-QB0HG1K",[[1,2046,"虽然我们"]],[2046,2046],[2050,2050]]],[1560435082801,["70431@DESKTOP-QB0HG1K",[[-1,2046,"虽然我们"]],[2050,2050],[2046,2046]]],[1560435088883,["70431@DESKTOP-QB0HG1K",[[1,2046,"虽然已经有这个效果，"]],[2046,2046],[2056,2056]]],[1560435151000,[null,[[-1,1940,"运"],[1,1941,"\n"],[-1,2058,"行结果如图所示：\n![](https://github.com/Yx1aoq1/Yx1aoq1.github.io/raw/master/images/ys-2.png)\n"]],[1940,1940],[2058,2058]]],[1560435151000,[null,[[1,1940,"运"],[-1,1940,"\n"],[1,2058,"行结果如图所示：\n![](https://github.com/Yx1aoq1/Yx1aoq1.github.io/raw/master/images/ys-2.png)\n"]],[2058,2058],[1940,1940]]],[1560435094521,["70431@DESKTOP-QB0HG1K",[[1,2056,"但是r"]],[2056,2056],[2059,2059]]],[1560435094949,["70431@DESKTOP-QB0HG1K",[[-1,2058,"r"]],[2059,2059],[2058,2058]]],[1560435095426,["70431@DESKTOP-QB0HG1K",[[1,2058,"·"]],[2058,2058],[2059,2059]]],[1560435096160,["70431@DESKTOP-QB0HG1K",[[-1,2058,"·"]],[2059,2059],[2058,2058]]],[1560435147586,["70431@DESKTOP-QB0HG1K",[[1,2058,"`rename.js`能做的也只是将它所在文件夹地下的文件进行重命名，但我们实际的情况是，想在某个文件夹"]],[2058,2058],[2110,2110]]],[1560435210978,[null,[[-1,1940,"运"],[1,1941,"\n"],[-1,2112,"行结果如图所示：\n![](https://github.com/Yx1aoq1/Yx1aoq1.github.io/raw/master/images/ys-2.png)\n"]],[1940,1940],[2112,2112]]],[1560435210978,[null,[[1,1940,"运"],[-1,1940,"\n"],[1,2112,"行结果如图所示：\n![](https://github.com/Yx1aoq1/Yx1aoq1.github.io/raw/master/images/ys-2.png)\n"]],[2112,2112],[1940,1940]]],[1560435158422,["70431@DESKTOP-QB0HG1K",[[1,2110,"底下执行`rn"]],[2110,2110],[2117,2117]]],[1560435158984,["70431@DESKTOP-QB0HG1K",[[-1,2116,"n"]],[2117,2117],[2116,2116]]],[1560435171400,["70431@DESKTOP-QB0HG1K",[[1,2116,"ename xxx`的命令，就能实习"]],[2116,2116],[2134,2134]]],[1560435171918,["70431@DESKTOP-QB0HG1K",[[-1,2132,"实习"]],[2134,2134],[2132,2132]]],[1560435178408,["70431@DESKTOP-QB0HG1K",[[1,2132,"将文件夹下的"]],[2132,2132],[2138,2138]]],[1560435182745,["70431@DESKTOP-QB0HG1K",[[-1,2130,"就能将文件夹下的"]],[2138,2138],[2130,2130]]],[1560435190622,["70431@DESKTOP-QB0HG1K",[[1,2130,"而不是将`rename,"]],[2130,2130],[2142,2142]]],[1560435191316,["70431@DESKTOP-QB0HG1K",[[-1,2141,","]],[2142,2142],[2141,2141]]],[1560435199460,["70431@DESKTOP-QB0HG1K",[[1,2141,".js`搬来搬去，所以我们"]],[2141,2141],[2154,2154]]],[1560435200969,["70431@DESKTOP-QB0HG1K",[[-1,2149,"，所以我们"]],[2154,2154],[2149,2149]]],[1560435210171,["70431@DESKTOP-QB0HG1K",[[1,2149,"。因此，我们可以将这个"]],[2149,2149],[2160,2160]]],[1560435237751,[null,[[-1,1940,"运"],[1,1941,"\n"],[-1,2162,"行结果如图所示：\n![](https://github.com/Yx1aoq1/Yx1aoq1.github.io/raw/master/images/ys-2.png)\n"]],[1940,1940],[2162,2162]]],[1560435237751,[null,[[1,1940,"运"],[-1,1940,"\n"],[1,2162,"行结果如图所示：\n![](https://github.com/Yx1aoq1/Yx1aoq1.github.io/raw/master/images/ys-2.png)\n"]],[2162,2162],[1940,1940]]],[1560435214014,["70431@DESKTOP-QB0HG1K",[[1,2160,"命令挂"]],[2160,2160],[2163,2163]]],[1560435214336,["70431@DESKTOP-QB0HG1K",[[-1,2162,"挂"]],[2163,2163],[2162,2162]]],[1560435218272,["70431@DESKTOP-QB0HG1K",[[1,2162,"通过`np,"]],[2162,2162],[2168,2168]]],[1560435218834,["70431@DESKTOP-QB0HG1K",[[-1,2167,","]],[2168,2168],[2167,2167]]],[1560435226784,["70431@DESKTOP-QB0HG1K",[[1,2167,"m link`挂到npm"]],[2167,2167],[2179,2179]]],[1560435228530,["70431@DESKTOP-QB0HG1K",[[-1,2176,"npm"]],[2179,2179],[2176,2176]]],[1560435229131,["70431@DESKTOP-QB0HG1K",[[1,2176,"·"]],[2176,2176],[2177,2177]]],[1560435229834,["70431@DESKTOP-QB0HG1K",[[-1,2176,"·"]],[2177,2177],[2176,2176]]],[1560435236503,["70431@DESKTOP-QB0HG1K",[[1,2176,"`npm`上。"]],[2176,2176],[2183,2183]]],[1560435262972,[null,[[-1,1940,"运"],[1,1941,"\n"],[-1,2185,"行结果如图所示：\n![](https://github.com/Yx1aoq1/Yx1aoq1.github.io/raw/master/images/ys-2.png)\n"]],[1940,1940],[2185,2185]]],[1560435262972,[null,[[1,1940,"运"],[-1,1940,"\n"],[1,2185,"行结果如图所示：\n![](https://github.com/Yx1aoq1/Yx1aoq1.github.io/raw/master/images/ys-2.png)\n"]],[2185,2185],[1940,1940]]],[1560435261660,["70431@DESKTOP-QB0HG1K",[[1,2185,"\n"]],[2183,2183],[2184,2184]]],[1560435262238,["70431@DESKTOP-QB0HG1K",[[1,2186,"\n"]],[2184,2184],[2185,2185]]]],null,"70431@DESKTOP-QB0HG1K"]]}